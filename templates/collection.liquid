{% paginate collection.products by 50 %}

  <!-- tags for filtering collection -->
  {% section 'filter' %}

  <!-- products -->
  <div class="collection" data-section-id="{{ section.id }}" data-section-type="collection">
  {% for product in collection.products %}
    {% for option in product.options %}
      {% if option == 'Color' %}
        {% assign index = forloop.index0 %}
        {% assign colorlist = '' %}
        {% assign color = '' %}
        {% for variant in product.variants %}
          {% assign variantLoop = forloop %}
          {% capture color %}
          {{ variant.options[index] }}
          {% endcapture %}
          {% unless colorlist contains color %}
            <!-- Product Goes Here -->
            {%- assign featured_image = variant.image %}
            {% if featured_image == null %}
              {%- assign featured_image = product.featured_image   -%}
            {% endif %}
            <a href="{{ variant.url }}">
              <div class="product">
                <!-- iterate through images -->
                {% for image in product.images %}
                  <!-- hide non-featured images -->
                  {% capture wrapper_class %}
                    {%- unless featured_image == image -%}
                      hide
                    {%- endunless -%}
                  {% endcapture %}
                  <!-- find background image -->
                  {% if forloop.last == true or product.images[forloop.index].attached_to_variant? == true %}
                    {% assign background_image = image %}
                  {% else %}
                    {% assign background_image = product.images[forloop.index] %}
                  {% endif%}

                  <div class="image bhgt" style="background-image: url({{ background_image | img_url: 'master' }})">
                      {% include 'responsive-image' with
                        image: image
                        max_width: 800,
                        max_height: 1000,
                        image_attributes: "data-product-featured-image",
                        wrapper_attributes: "data-product-image-wrapper",
                        wrapper_class: wrapper_class
                      %}
                  </div>
                {% endfor %}
                <div class="information">
                  <p class="arrow">↳</p>
                  <p class="price">
                    {% if product.compare_at_price > product.price %}

                      {% if product.price_varies %}
                        {%- assign sale_price = product.price | money -%}
                        {{ 'products.product.on_sale_from_html' | t: price: sale_price }}
                      {% else %}
                        {{ 'products.product.on_sale' | t }}
                        {{ product.price | money }}
                      {% endif %}

                    {% else %}

                      {% if product.price_varies %}
                        {%- assign price = product.price | money -%}
                        {{ 'products.product.from_text_html' | t: price: price }}
                      {% else %}
                        {{ product.price | money }}
                      {% endif %}

                    {% endif %}

                    {% if product.compare_at_price > product.price %}
                      <span class="visually-hidden">{{ 'products.product.regular_price' | t }}</span>
                      <s>{{ product.compare_at_price | money }}</s>
                    {% endif %}

                    {% unless product.available %}
                      {{ 'products.product.sold_out' | t }}
                    {% endunless %}
                  </p>
                <p class="seperator"> — </p>
                <p class="title">
                  <a href="{{ product.url | within: collection }}">{{ product.title }}</a>
                </p>
                </div>
                <!-- colors -->
                <div>
                  {% form 'product', product, data-product-form: '', data-product-handle: product.handle, data-enable-history-state: 'true' %}
                    {% unless product.has_only_default_variant %}
                      {% for option in product.options_with_values reversed %}
                        <!-- Color Options -->
                        {% if option.name == 'Color' %}
                          <div class="js {{ option.name | downcase }}">
                            <!-- loop over product variants to find first variant with Color of {value} to link to -->
                            {% for value in option.values %}
                              {% for variant in product.variants %}
                                <!-- if this variant has a 'Color' option with {value} of  -->
                                {% if variant.title contains value %}
                                  <a href="{{ variant.url }}">
                                    <input type="radio" id="Option{{ option.position }}-{{ value }}-{{ section.id}}-{{ product.id }}-{{ variantLoop.index }}" name="options[{{ option.name }}]" value="{{ value }}" {% if color contains value %}checked{% endif %}>
                                    <label href="{{ variant.url }}" class="color-label" for="Option{{ option.position }}-{{ value }}-{{ section.id}}-{{ product.id }}-{{ variantLoop.index }}" style="background-color: {{ value }};" default-value="{{ color | strip }}"></label>
                                  </a>
                                  {% break %}
                                {% endif %}
                              {% endfor %}
                            {% endfor %}
                          </div>
                        {% endif %}
                      {% endfor %}
                    {% endunless %}
                  {% endform %}
                </div>
              </div>
            </a>
            <!-- End of Product -->
            {% capture tempList %}
            {{colorlist | append: color | append: " " }}

            {% endcapture %}

            {% assign colorlist = tempList %}
          {% endunless %}
        {% endfor %}
      {% endif %}
    {% endfor %}
  {% endfor %}
  </div>

  {% if paginate.pages > 1 %}
    {% include 'pagination' %}
  {% endif %}
{% endpaginate %}

{% section 'email-signup' %}
